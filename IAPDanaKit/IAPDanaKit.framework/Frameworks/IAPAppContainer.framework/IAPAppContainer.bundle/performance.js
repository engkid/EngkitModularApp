window.AlipayH5Performance||function(){function d(a){return Object.prototype.toString.call(a).replace(/\[object (\w+)\]/,"$1").toLowerCase()}var a,b,c,e,f;navigator.userAgent.indexOf(" AlipayClientHK/")<0||(a={},b={},c={},e={init:function(){this.init=null,this.renderIframe(),this.monitorDOMReady(),this.monitorPageLoad(),this.monitorJSErrors(),this.monitorDNSTime(),this.monitorCacheRate(),this.monitorMixedContent()},monitorDOMReady:function(){var a=this,b=/complete|loaded|interactive/;b.test(document.readyState)?(a.pushMessage("monitor",{name:"domReady",value:(new Date).getTime(),extra:"completed"}),a.sendSignal()):document.addEventListener("DOMContentLoaded",function(b){a.pushMessage("monitor",{name:"domReady",value:b.timeStamp?b.timeStamp:(new Date).getTime(),extra:"complete"}),a.sendSignal()},!0)},monitorPageLoad:function(){var a=this;window.addEventListener("load",function(b){a.pushMessage("monitor",{name:"pageLoad",value:b.timeStamp?b.timeStamp:(new Date).getTime(),extra:"load"}),a.sendSignal()},!0)},monitorJSErrors:function(){var a=this;window.addEventListener("error",function(b){a.pushMessage("monitor",{name:"jsErrors",value:b.message||b.srcElement.outerHTML.substr(0,30),filename:b.filename,lineno:b.lineno}),a.sendSignal()},!0)},monitorDNSTime:function(){var a=this;window.addEventListener("load",function(){window.performance&&window.performance.timing?a.pushMessage("monitor",{name:"dns",value:window.performance.timing.domainLookupEnd-window.performance.timing.domainLookupStart,extra:"support"}):a.pushMessage("monitor",{name:"dns",value:"",extra:"notsupport"}),a.sendSignal()},!0)},monitorMixedContent:function(){var a=this,b=[],c=/complete|loaded|interactive/;c.test(document.readyState)?("https:"==window.location.protocol&&[].slice.call(document.querySelectorAll('link[rel=stylesheet][href^="http:"], script[src^="http:"], img[src^="http:"]')).forEach(function(a){b.push(a.tagName+":"+(a.src||a.href))}),b.length>0&&(a.pushMessage("monitor",{name:"mixedContent",value:b.join("@|@")}),a.sendSignal())):document.addEventListener("DOMContentLoaded",function(){"https:"==window.location.protocol&&[].slice.call(document.querySelectorAll('link[rel=stylesheet][href^="http:"], script[src^="http:"], img[src^="http:"]')).forEach(function(a){b.push(a.tagName+":"+(a.src||a.href))}),b.length>0&&(a.pushMessage("monitor",{name:"mixedContent",value:b.join("@|@")}),a.sendSignal())},!0)},monitorCacheRate:function(){var c,a=this,b={name:"cacheRate"};window.addEventListener("load",function(){var e,f;if(window.performance&&"function"==typeof window.performance.getEntriesByType&&(c=window.performance.getEntriesByType("resource"))){if(c.length>0){for(e=0,f=0;f<c.length;f++)0===c[f].duration&&e++;b.value=(e/c.length).toFixed(4)}else b.value=0;b.extra="support"}else b.value="",b.extra="notsupport";a.pushMessage("monitor",b),a.sendSignal()},!0)},sendSignal:function(b,d){b="number"==typeof b&&b>=0?b:500,d=d||"monitor",clearTimeout(c[d]),c[d]=setTimeout(function(){a&&a[d]||this.renderIframe(d),a[d].src="alipay"+d.toLowerCase()+"://dispatch_"+d.toLowerCase()+"_message"},b)},renderIframe:function(b){if(b=b||"monitor",!a||!a[b])try{a[b]=document.createElement("iframe"),a[b].id="__AlipayH5"+b+"Iframe",a[b].style.display="none",document.documentElement.appendChild(a[b])}catch(c){}},pushMessage:function(a,c){a=a||"monitor",b&&"array"==d(b[a])||(b[a]=[]),b[a].push(c)},getMessage:function(a){a=a||"monitor",b&&"array"==d(b[a])||(b[a]=[]);var c=JSON.stringify(b[a]);return b[a]=[],c}},e.init(),f={fetchMessageQueue:function(a){return e.getMessage(a)},pushMessage:function(a,b){e.pushMessage(a,b)},addTrackData:function(a,b){b=b||"monitor",a.value&&(a.value+="|time="+(new Date).getTime()),e.pushMessage(b,a),e.sendSignal(0)},addTimeReport:function(a){var c,b="";for(c in a)b+=(""==b?"":"&")+c+"="+a[c];f.addTrackData({name:"timeReport",value:b})},sendSignal:function(a){e.renderIframe(a),e.sendSignal(0,a)},version:"1.2"},window.AlipayH5Performance=f)}(),window.AlipayH5Report||function(){if(!(navigator.userAgent.indexOf(" AlipayClientHK/")<0)){var a={fetchMessageQueue:function(){return window.AlipayH5Performance.fetchMessageQueue("report")}};window.AlipayH5Report=a}}();
